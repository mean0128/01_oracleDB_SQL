--	SubQuery_work.sql

/*
형식1)
main query	-> 2차 실행
as
sub query;	-> 1차 실행

형식2)
main query 관계연산자 (sub query);
*/


--	형식 1 example
create table dept01	--	main query(2차 실행)
as
select * from dept;	--	sub query(1차 실행)

select * from dept;
select * from dept01;	--	내용(data) + 구조(desc)

--	형식 2 example : main(dept),  sub(emp)
select * from emp;	--	deptno는 있으나, dname은 없음
select dname from  dept where deptno = (select deptno from emp where ename = 'SCOTT');

--	단일행 서브쿼리 실습
	-- example) emp table에서 SCOTT과 같은 부서에서 근무하는 사원의 이름과 부서 번호를 출력 : main(emp), sub(emp)
	select * from emp;
	select ename, deptno from emp where deptno = (select deptno from emp where ename ='SCOTT');

	--	example) emp table 에서 SCOTT과 동일한 직속상관(MGR)을 가진 사원을 출력하는 SQL 문을 작성
	select * from emp where mgr = (select mgr from emp where ename = 'SCOTT');

	--	example) emp table 에서 SCOTT의 급여와 동일하거나 더 많이 받는 사원 명과 급여를 출력
	select ename, sal from emp where sal >= (select sal from emp where ename = 'SCOTT') and ename != 'SCOTT';

	--	example) DALLAS에서 근무하는 사원의 이름, 부서 번호를 출력 : main(emp), sub(dept01)
	select * from dept01;
	select * from emp;
	select ename, deptno from emp where deptno = (select deptno from dept01 where loc ='DALLAS');	--	emp - dept01 테이블의 join

	--	example) SALES 부서에서 근무하는 모든 사원의 이름과 급여를 출력 : main(emp), sub(dept01)
	select * from dept01;
	select * from emp;
	select ename, sal from emp where deptno = (select deptno from dept01 where dname ='SALES') order by sal;

	--	example) RESEARCH 부서에서 근무하는 모든 사원 정보 : main(emp), sub(dept01)
	select * from emp where deptno = (select deptno from dept01 where dname ='RESEARCH');	

--	단일행 서브 쿼리(그룹[집합] 함수)
	--	example) emp table에서 평균 급여보다 더 많이 받는 사원 정보 출력
	select * from emp where sal >= (select avg(sal) from emp);

	--	example) emp table에서 평균 급여보다 더 적게 받는 사원 정보 출력
	select * from emp where sal <= (select avg(sal) from emp);
		--	그룹 함수
		select sum(sal) from emp;
		select max(sal) from emp;
		select min(sal) from emp;
		
--	다중행 서브 쿼리(in, any, some, all, exist) : sub query의 행이 2개 이상인 경우
	--	in : 메인 쿼리의 비교 조건(‘=’ 연산자로 비교할 경우)이 서브 쿼리의 결과 중에서 하나라도 일치하면 참
		--	example)
		select ename, sal, deptno from emp where deptno in (select distinct deptno from emp where sal >= 3000);

		--	example) JOB이 MANAGER인 사람이 속한 부서의 부서 번호와 부서명과 지역 출력 : main(dept01), sub(emp)
		select deptno, dname, loc from dept01 where deptno in (select deptno from emp where job = 'MANAGER');
	
	--	all : 서브쿼리의 최대값 이상 검색, 전체 데이터 각각과 비교하여 조건식을 만족하면 참
		--	example)
		select ename, sal from emp where sal > all (select sal from emp where deptno = 30);	--	950 ~ 2850
		
	--	any : 최소값 이상 검색, 메인 쿼리의 비교 조건이 서브 쿼리의 검색 결과와 하나 이상이 일치하면 참
		--	example)
		select ename, sal from emp where sal >= any (select sal from emp where deptno = 30);
		
